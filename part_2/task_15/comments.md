Хороший пример дан на java. Показано как делать не нужно и как делать нужно.